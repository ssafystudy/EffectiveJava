# 아이템 24. 멤버 클래스는 되도록 static으로 만들라

중첩클래스(nested class)는 클래스 안에 정의된 클래스를 말한다. 이렇게 정의된 클래스는 자신을 감싼 바로 바깥의 클ㄹ스에서만 쓰여야하며, 이 외의 다른 위치에서 접근이 필요하다면 바깥으로 빼내야만 한다.

중첩 클래스의 종류는 정적 멤버 클래스, 멤버클래스, 익명 클래스, 지역 클래스 등 총 4가지로 구분된다. 정적 멤버 클래스를 제외한 나머지 3가지는 내부 클래스로 정의한다.

정적 멤버 클래스는 다른 클래스의 내부에 선언되고 바깥 클래스의 private 멤버에도 접근할 수 있다는 특성을 가지며, 이를 제외하면 여타 클래스와 다르지 않다.
정적 멤버 클래스는 바깥 클래스와 함께 쓰일때만 유용한 public helper class로 쓰인다. 예를 들어, Operation이라는 enum타입은 Calculator 클래스의 public 정적 멤버 클래스가 되어야한다. 그러면 Calculator.Operation.PLUS, Calculator.Operation.MINUS 등의 형태로 원하는 연산을 참조할 수 있다.

비정적 멤버는 단순히 static이 붙었는지에 따라 정적 멤버 클래스와 구분된다. 하지만, 의미상의 차이는 상당히 큰데, 비정적 멤버 클래스의 인스턴스는 바깥 클래스의 인스턴스와 암묵적으로 연결된다. 따라서, 정규화된 this를 사용해 바깥 인스턴스의 메소드를 호출하거나 참조를 가져올 수 있다. 여기서 정규화된 this란 ClassName.this의 형태로 바깥 클래스의 이름을 명시하는것을 말한다.

비정적 멤버 클래스의 인스턴스와 바깥 인스턴스 사이의 관계는 멤버 클래스가 인스턴스화될 때 확립되며, 변경할 수 없다.

비정적 멤버 클래스는 어댑터를 정의할 때 자주 쓰인다.

```java
public class MySet<E> extends AbstractSet<E> {
    ... // 생략

    @Override public Iterator<E> iterator() {
        return new MyIterator();
    }

    public class MyIterator implements Iterator<E> {
        ... // 생략
    }
```

멤버 클래스에서 바깥 인스턴스에 접근할 일이 없다면 무조건 static을 붙여서 정적 멤버 클래스로 만들어야한다. static을 생략하면 바깥 인스턴스를 참조하는 외부 참조를 갖게 된다. 즉, 불필요한 시간/공간 낭비가 발생한다는 의미이다. 또한, GC가 바깥 클래스 인스턴스를 회수하지 못하므로 memory leak이 발생할 수 있다.

private 정적 멤버 클래스는 바깥 클래스가 표현하는 객체의 구성요소를 나타낼 때 쓴다. Map 타입의 인스턴스는 키-값 쌍을 표현하는 엔트리 객체들을 가지고 있다. 모든 엔트리가 맵과 연관되어 있지만, getKey, getValue, setValue 등의 메소드는 맵을 직접 사용하지 않기 때문에 비정적 멤버 클래스로 표현하면 낭비가 발생하지만, private 정적 멤버 클래스는 이러한 낭비가 발생하지 않는다.

익명 클래스는 이름이 없는 내부 클래스이며, 바깥 클래스의 멤버도 아니다. 사용 시점에 선언과 동시에 인스턴스가 생성되며, 비정적인 context에서 사용될 때만 바깥 클래스의 인스턴스를 참조할 수 있다.
다만, 익명 클래스는 제약이 많은 편인데, 선언한 지점에서만 인스턴스의 생성이 가능하며, instanceof 검사나 클래스 이름이 필요한 작업의 수행은 불가능하다. 여러 인터페이스의 구현이 불가능하며, 상위 타입에서 상속한 멤버 외에는 호출할 수 없다. 익명 클래스의 길이가 긴 경우 가독성이 떨어지는 문제도 존재한다.

지역클래스는 나머지 중첩 클래스에 비해 가장 적은 빈도로 사용된다. 지역 클래스는 지역변수를 선언할 수 있는 곳이라면 어디서든 선언할 수 있고, 유효 범위도 지역변수와 같다. 다른 중첩 클래스와의 공통점도 가지고 있다. 멤버 클래스처럼 이름이 있고 반복해서 사용할 수 있으며, 익명 클래스의 경우처럼 비정적 문맥에서 사용될때만 바깥 인스턴스를 참조할 수 있다. 정적 멤버는 가질 수 없고, 가독성을 위해 짧게 작성해야만 한다.
